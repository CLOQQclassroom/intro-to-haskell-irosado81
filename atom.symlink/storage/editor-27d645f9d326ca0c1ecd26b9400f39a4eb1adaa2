{"mode":"editor","version":1,"windowDimensions":{"x":0,"y":0,"width":1440,"height":900},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/mark/src/Shopify/src/shopify","buffers":[{"text":"class Shopify.CollectionProducts\n  REFRESH_KEYS: ['collection_products', 'collection_sort_order']\n\n  constructor: (@collectionId, @selectedProducts) ->\n    @loading = false\n\n  addProduct: (productId) ->\n    return if @productSelected(productId)\n    @selectedProducts.push(productId)\n    @_collectsRequest\n      collect: { collection_id: @collectionId, product_id: productId },\n      '/admin/collects.json',\n      'Product has been added to this collection successfully'\n\n\n  removeProductInlineFromTable: (productId) ->\n    index = @selectedProducts.indexOf(productId)\n    return if index < 0\n\n    $(\"#sortable_product_#{productId}\").remove()\n    @selectedProducts.splice(index, 1)\n    @loading = true\n\n    xhr = $.ajax\n      url: \"/admin/collects/#{productId}-#{@collectionId}.json\"\n      dataType: 'json'\n      type: 'POST'\n      data: {_method: 'DELETE'}\n\n    xhr.done =>\n      @loading = false\n      Shopify.Flash.notice 'Product has been removed from this collection successfully'\n\n  removeProduct: (productId) ->\n    index = @selectedProducts.indexOf(productId)\n    return if index < 0\n\n    @selectedProducts.splice(index, 1)\n    @_collectsRequest\n      _method: 'DELETE',\n      \"/admin/collects/#{productId}-#{@collectionId}.json\",\n      'Product has been removed from this collection successfully'\n\n  productSelected: (productId) ->\n    productId in @selectedProducts\n\n  toggleProduct: (productId, event) ->\n    event.stopPropagation()\n    if @productSelected(productId)\n      @removeProduct(productId)\n    else\n      @addProduct(productId)\n\n  _collectsRequest: (data, url, flashMessage) ->\n    @loading = true\n    xhr = $.ajax\n      url: url\n      dataType: 'json'\n      type: 'POST'\n      data: data\n\n    xhr.done =>\n      Page.refresh { onlyKeys: @REFRESH_KEYS }, =>\n        @loading = false\n        Shopify.Flash.notice flashMessage\n","markers":{"markers":{"1":{"id":1,"range":[[42,0],[42,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":149,"goalBufferRange":null,"preserveFolds":true},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/mark/src/Shopify/src/shopify/app/assets/javascripts/admin_next/modules/collections/collection_products.coffee","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"be8217f1ac824c6aef5e8c55fe10c715539d2a4b","deserializer":"TextBuffer"},{"text":"<% if collection.persisted? %>\n  <div id=\"js-products\" class=\"row section products\">\n    <div class=\"span6 section-summary\">\n      <h1>Products</h1>\n      <% if collection.custom? %>\n        <p>Manage the products that belong to this collection.</p>\n      <% else %>\n        <% if @collects.present? %>\n          <p>These are the products that match the conditions listed above.</p>\n        <% else %>\n          <p>No products match the conditions for this collection.</p>\n        <% end %>\n      <% end %>\n\n      <div id=\"collection-sort-order\" refresh=\"collection_sort_order\">\n        <% if @collects.present? %>\n          <label for=\"sort-collection\" class=\"note\">Sort this collection:</label>\n          <select id=\"sort-collection\" class=\"ssb\" name=\"collection[sort_order]\" define=\"{sortOrder: '<%= collection.sort_order %>'}\" bind=\"sortOrder\">\n            <% Collection::ALLOWED_SORT_ORDERS_WITH_NAMES.each do |value, name| %>\n              <option value=\"<%= value %>\"><%= name %></option>\n            <% end %>\n          </select>\n        <% end %>\n      </div>\n\n      <% if collection.custom? %>\n        <div class=\"dropdown-container\" id=\"partial_container\">\n          <%= remote_partial href: dropdown_admin_products_path, define: \"{dropdownPartial: new Shopify.ResourceDropdown(this, 'partial_container')}\"%>\n          <a href=\"#\" class=\"btn slim\" data-dropdown=\"~ .dropdown\" bind-event-click=\"dropdownPartial.renderDropdown(event)\">Add Products <i class=\"ico ico-16x8 ico-disclosure\"></i></a>\n        </div>\n      <% end %>\n    </div>\n\n    <div class=\"span18 section-content\" define=\"{collectionProducts: new Shopify.CollectionProducts(<%= @collection.id %>, <%= @product_ids.to_json %>)}\" id=\"collection\" refresh=\"collection_products\">\n      <% if @collects.present? %>\n        <table class=\"border-bottom\" id=\"collection-products\" refresh=\"products_table\" bind-class=\"{'is-rebuilding': collectionProducts.loading}\">\n          <tbody>\n            <% @collects.each do |collect| %>\n              <% product = collect.product %>\n              <tr id=\"sortable_product_<%= product.id %>\">\n                <td class=\"drag\" bind-show=\"sortOrder == 'manual'\">\n                  <a href=\"#\" class=\"drag-handle draggable\">Drag</a>\n                </td>\n                <td class=\"image icon\">\n                  <label for=\"product-<%= product.id %>\" class=\"s-none\">\n                    <% if product.featured_image %>\n                      <%= image_tag product.featured_image.src(relative: true), title: product.title, class: 'block s-none' %>\n                    <% else %>\n                      <%= image_tag asset_path('no-image.png'), title: product.title, class: 'block s-none product-image-is-blank' %>\n                    <% end %>\n                  </label>\n                </td>\n                <td>\n                  <%= link_to product.title, admin_product_path(product), class: 'subdued product-link' %>\n                  <% unless product.is_published %><span class=\"label sl\">Hidden</span><% end %>\n                </td>\n                <% if @collection.custom? %>\n                  <td class=\"remove tr\">\n                    <a bind-event-click=\"collectionProducts.removeProductInlineFromTable(<%= product.id %>)\" class=\"btn btn-ico-small tooltip tooltip-bottom\">\n                      <span class=\"tooltip-container\">\n                        <span class=\"tooltip-label\">Remove</span>\n                      </span>\n                      <i class=\"ico ico-16 ico-remove\"></i>\n                    </a>\n                  </td>\n                <% end %>\n              </tr>\n            <% end %>\n          </tbody>\n        </table>\n\n        <div class=\"box actions tr s-none\">\n          <a class=\"btn\">Show all products</a>\n          <%= render 'admin/shared/pagination', paginator: @collects_paginator, pagination_links_id: 'product-pagination-links', refresh_key: 'collection_products' %>\n        </div>\n      <% else %>\n        <div class=\"row\">\n          <div class=\"blank-slate slim\">\n            <i class=\"ico ico-72 ico-collections\"></i>\n            <h2>There are no products in this collection</h2>\n          </div>\n        </div>\n      <% end %>\n    </div>\n  </div>\n<% end %>\n","markers":{"markers":{"1":{"id":1,"range":[[56,0],[56,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":202,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/mark/src/Shopify/src/shopify/app/views/admin/collections/_products.html.erb","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"097eb58d4d84d979aaea0985e968cf74a53eca07","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":7,"items":[{"id":149,"softTabs":true,"displayBuffer":{"id":150,"softWrap":false,"editorWidthInChars":null,"scrollTop":482,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/mark/src/Shopify/src/shopify/app/assets/javascripts/admin_next/modules/collections/collection_products.coffee","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":202,"softTabs":true,"displayBuffer":{"id":203,"softWrap":false,"editorWidthInChars":null,"scrollTop":357,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/mark/src/Shopify/src/shopify/app/views/admin/collections/_products.html.erb","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/mark/src/Shopify/src/shopify/app/views/admin/collections/_products.html.erb","focused":true,"deserializer":"Pane"},"activePaneId":7,"deserializer":"PaneContainer","version":1},"fullScreen":true,"packagesWithActiveGrammars":["language-coffee-script","language-ruby","language-html"],"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/mark/src/Shopify/src/shopify/app/assets/javascripts/admin_next/modules/collections/collection_products.coffee":1404825696858,"/Users/mark/src/Shopify/src/shopify/app/views/admin/collections/_products.html.erb":1404825715204},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":77863},"tree-view":{"directoryExpansionStates":{},"selectedPath":"/Users/mark/src/Shopify/src/shopify/app","hasFocus":false,"attached":false,"scrollLeft":0,"scrollTop":0,"width":0},"html2haml":{}}}